(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30e29da0"],{1579:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"c-library-content-editor"},[o("el-tabs",{directives:[{name:"show",rawName:"v-show",value:t.isEditorMode,expression:"isEditorMode"}],attrs:{type:"card",closable:""},on:{"tab-remove":t.onRemoveDocEditor},model:{value:t.activeDocEditor,callback:function(e){t.activeDocEditor=e},expression:"activeDocEditor"}},t._l(t.docEditorCollection,(function(e){return o("el-tab-pane",{key:e.id,attrs:{label:e.title,name:e.id}},[o("span",{class:t.docEditorSaveStatusCollection.indexOf(e.id)>=0?"not-save":"",attrs:{slot:"label"},slot:"label"},[t._v("\n                "+t._s(e.title)+"\n            ")]),o("c-library-editor-meta",{attrs:{loading:t.saveLoading,meta:e},on:{input:function(o){return t.onEditorInput(e)}}}),o("el-scrollbar",{staticStyle:{height:"calc(100vh - 125px)"}},[o("c-library-editor",{ref:"docEditor",refInFor:!0,attrs:{"init-content":e.content},on:{input:function(o){return t.onEditorInput(e)}}})],1)],1)})),1),o("c-library-editorwelcome",{directives:[{name:"show",rawName:"v-show",value:!t.isEditorMode,expression:"!isEditorMode"}]})],1)},n=[],r=(o("96cf"),o("3b8d")),c=o("5710"),a={name:"c-library-content-editor",components:{"c-library-editor":function(){return o.e("chunk-2d0e5395").then(o.bind(null,"9426"))},"c-library-editor-meta":function(){return o.e("chunk-50a9f249").then(o.bind(null,"db78"))},"c-library-editorwelcome":function(){return o.e("chunk-31de7220").then(o.bind(null,"36da"))}},mixins:[c["a"]],computed:{docEditorMap:function(){var t={};return this.$utils.ForEach(this.docEditorCollection,(function(e,o){t[e.id]=o})),t},activeDoc:function(){return this.docEditorCollection[this.docEditorMap[this.activeDocEditor]]},isEditorMode:function(){return""!==this.activeDocEditor&&"0"!==this.activeDocEditor}},data:function(){return{activeDocEditor:"",docEditorCollection:[],docEditorSaveStatusCollection:[],creatorCounter:0,saveLoading:!1}},created:function(){this.globalDocSaveShortcutKeyHandler(!0)},destroyed:function(){this.globalDocSaveShortcutKeyHandler(!1)},methods:{initEventBus:function(t){var e=this;t.$on("doc-will-create",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.useCreateDocEditor(t,o)})),t.$on("doc-will-modify",(function(t){e.useModifyDocEditor(t)})),t.$on("doc-save",function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(o){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=o.docId,n=o.done,t.next=3,e.docSaveById(i);case 3:"function"===typeof n&&n();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.$on("doc-save-as",function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(o){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=o.docInfo,n=o.done,r=e.fetchEditorDocInfo(i.id),t.next=4,e.docSave({library_doc_id:0,library_id:i.libraryId,title:i.title,content:r.content,group_id:i.groupId},n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.$on("doc-fetch-content",(function(t){var o=t.docId;return e.fetchEditorDocInfo(o)})),t.$on("doc-template-use",(function(t){var o=e.fetchEditorDocContent(e.activeDoc.id),i=e.docEditorMap[e.activeDoc.id];o.trim()?e.$utils.Confirm("是否使用该模板，该操作将会替换正在编辑的内容！").then((function(){e.activeDoc.content=t.content,e.tagDocNotSave(e.activeDoc.id),e.$refs.docEditor[i].setContent(t.content)})):(e.activeDoc.content=t.content,e.$refs.docEditor[i].setContent(t.content))})),t.$on("doc-removed",(function(t){var o=t.docId,i=t.groupId,n=void 0===i?-1:i;o=String(o);var r=e.fetchEditorDocInfo(o);r&&(r.id="t"+e.creatorCounter++,n>=0&&(r.groupId=n),e.activeDocEditor===o&&e.handleActiveDocEditor(r.id),e.tagDocNotSave(r.id))})),t.$on("doc-modifyed",(function(t){var o=t.docId;void 0===e.docEditorMap[o]&&0!==String(o).indexOf("t")||e.tagDocNotSave(String(o))})),t.$on("doc-history-recovery",(function(t){var o=e.docEditorMap[t.doc_id],i=e.docEditorCollection[o];i.groupId=t.group_id,i.title=t.title,i.content=t.content,e.$refs.docEditor[o].setContent(i.content),e.tagDocNotSave(t.doc_id)}))},docSaveById:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var o,i,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=this.fetchEditorDocInfo(e),o){t.next=4;break}return this.$tip.error("文档内容错误，请重试编辑"),t.abrupt("return",!1);case 4:return i={library_doc_id:e>>0,library_id:o.libraryId,title:o.title,content:o.content,group_id:o.groupId},t.next=7,this.docSave(i,(function(t){var e=t.resData,r=t.$resError;if(r)return!1;0===i.library_doc_id?(n.docEditorCollection[o.editorIndex].id=e.id,n.handleActiveDocEditor(e.id)):n.docEditorCollection[o.editorIndex].updateTime=e.update_time}));case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),docSave:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,o){var i,n,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=!1,n=e.library_doc_id>0?this.$api.v1.LibraryDocModify:this.$api.v1.LibraryDocCreate,t.next=4,n(e,{loading:function(t){r.saveLoading=t},report:!0}).then((function(t){i=t,r.libraryContentEventBus.$emit("doc-saved",t.resData.id)})).catch((function(t){i=t,r.$tip.error(t.resMsg)}));case 4:return this.untagDocNotSave(e.library_doc_id),"function"===typeof o&&o(i),t.abrupt("return",i);case 7:case"end":return t.stop()}}),t,this)})));function e(e,o){return t.apply(this,arguments)}return e}(),tagDocNotSave:function(t){t+="",this.docEditorSaveStatusCollection.push(t)},untagDocNotSave:function(t){this.docEditorSaveStatusCollection=this.docEditorSaveStatusCollection.filter((function(e){return e>>0!==t>>0}))},useCreateDocEditor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.creatorCounter++,e=e||"无标题-"+this.creatorCounter;var o="t"+this.creatorCounter;this.useDocEditor({id:o,libraryId:this.libraryId,title:e,content:"",groupId:t,updateTime:0}),this.tagDocNotSave(o)},useModifyDocEditor:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$api.v1.LibraryDocInfo({library_id:this.libraryId,library_doc_id:e});case 2:o=t.sent,i=o.resData,this.useDocEditor({id:String(e),libraryId:i.library_id,title:i.title,content:i.content,groupId:i.group_id,updateTime:i.update_time});case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),useDocEditor:function(t){this.checkExistDocEditor(t.id)||this.docEditorCollection.push(t),this.handleActiveDocEditor(t.id)},fetchEditorDocInfo:function(t){var e=this.docEditorMap[t];if(void 0===e||!this.$refs.docEditor[e])return!1;var o=this.docEditorCollection[e],i=this.$refs.docEditor[e].fetchContent();return o.content=i,o.editorIndex=e,o},fetchEditorDocContent:function(t){var e=this.docEditorMap[t];return void 0!==e&&this.$refs.docEditor[e]?this.$refs.docEditor[e].fetchContent():""},handleActiveDocEditor:function(t){t=String(t),this.activeDocEditor=t},checkExistDocEditor:function(t){return void 0!==this.docEditorMap[t]},onRemoveDocEditor:function(t){var e=this.docEditorCollection,o=this.activeDocEditor;if(o===t){var i=this.docEditorMap[t],n=e[i+1]||e[i-1];this.activeDocEditor=n?n.id:""}this.docEditorCollection=e.filter((function(e){return e.id!==t})),this.untagDocNotSave(o)},onEditorInput:function(t){this.tagDocNotSave(t.id)},globalDocSaveShortcutKeyHandler:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o="keydown";e?(this.$saveEventAction=function(e){return 83!==e.which||!e.ctrlKey||(t.activeDocEditor&&"0"!==t.activeDocEditor&&t.docSaveById(t.activeDocEditor),e.preventDefault(),!1)},window.addEventListener(o,this.$saveEventAction)):window.removeEventListener(o,this.$saveEventAction)}}},d=a,u=(o("333a"),o("2877")),s=Object(u["a"])(d,i,n,!1,null,null,null);e["default"]=s.exports},"1dc3":function(t,e,o){},"333a":function(t,e,o){"use strict";var i=o("1dc3"),n=o.n(i);n.a},5710:function(t,e,o){"use strict";o("96cf");var i=o("3b8d"),n=o("6c47");e["a"]={mixins:[n["a"]],inject:["libraryContentEventBus"],watch:{libraryId:{handler:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e>0)){t.next=5;break}if(t.t0=this.initComponent,!t.t0){t.next=5;break}return t.next=5,this.initComponent();case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),immediate:!0}},created:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.initEventBus&&this.initEventBus(this.libraryContentEventBus);case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:{initEventBus:function(t){},initComponent:function(){}}}}}]);