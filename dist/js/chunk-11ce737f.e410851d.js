(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11ce737f"],{"2f21":function(e,t,r){"use strict";var n=r("79e5");e.exports=function(e,t){return!!e&&n((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},"55dd":function(e,t,r){"use strict";var n=r("5ca1"),o=r("d8e8"),i=r("4bf8"),a=r("79e5"),c=[].sort,s=[1,2,3];n(n.P+n.F*(a((function(){s.sort(void 0)}))||!a((function(){s.sort(null)}))||!r("2f21")(c)),"Array",{sort:function(e){return void 0===e?c.call(i(this)):c.call(i(this),o(e))}})},5710:function(e,t,r){"use strict";r("96cf");var n=r("3b8d"),o=r("6c47");t["a"]={mixins:[o["a"]],inject:["libraryContentEventBus"],watch:{libraryId:{handler:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=5;break}if(e.t0=this.initComponent,!e.t0){e.next=5;break}return e.next=5,this.initComponent();case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),immediate:!0}},created:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.initEventBus&&this.initEventBus(this.libraryContentEventBus);case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{initEventBus:function(e){},initComponent:function(){}}}},"5dbc":function(e,t,r){var n=r("d3f4"),o=r("8b97").set;e.exports=function(e,t,r){var i,a=t.constructor;return a!==r&&"function"==typeof a&&(i=a.prototype)!==r.prototype&&n(i)&&o&&o(e,i),e}},6757:function(e,t,r){"use strict";var n=r("6f58"),o=r.n(n);o.a},"6f58":function(e,t,r){},"6fc0":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.groupTreeLoading,expression:"groupTreeLoading"}],staticClass:"c-library-content-tree"},[r("el-input",{staticClass:"directory-tree-search",attrs:{size:"small",placeholder:"输入关键字，检索目录与文档",clearable:""},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}}),r("el-scrollbar",{staticClass:"tree"},[r("div",{on:{contextmenu:function(t){return t.preventDefault(),e.onNodeContextMenu(t)}}},[r("el-tree",{attrs:{"element-loading-spinner":"el-icon-loading",data:e.dataTree,props:e.defaultProps,"node-key":"key","allow-drop":e.handleAllowDrop,"empty-text":e.emptyText,draggable:"","default-expand-all":""},on:{"node-click":e.onNodeClick,"node-drop":e.onNodeDrop},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,o=t.data;return r("div",{staticClass:"directory-tree-item"},["group"===o.nodeType?r("i",{staticClass:"tree-node-group-icon icon y-icon-folder-close"}):r("i",{staticClass:"tree-node-doc-icon el-icon-document"}),r("el-tooltip",{attrs:{content:o.name,"open-delay":800,effect:"dark",placement:"top-end"}},[r("span",{staticClass:"tree-node-label",attrs:{level:n.level}},[e._v(e._s(o.name))])]),r("el-dropdown",{staticClass:"item-actions",attrs:{trigger:"click"},on:{command:e.onItemAction}},[r("span",{staticClass:"el-dropdown-link",on:{click:function(e){e.stopPropagation()}}},[r("i",{staticClass:"el-icon-more item-more-action"})]),"group"===o.nodeType?r("el-dropdown-menu",{ref:"libraryGroupMneu",attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{attrs:{command:"modifyGroup|"+o.id}},[r("i",{staticClass:"el-icon-edit"}),e._v("编辑分组\n                            ")]),r("el-dropdown-item",{attrs:{command:"createGroup|"+o.id}},[r("i",{staticClass:"el-icon-folder-add"}),e._v("新增子分组\n                            ")]),r("el-dropdown-item",{attrs:{command:"createDoc|"+o.id}},[r("i",{staticClass:"el-icon-document-add"}),e._v("新增文档\n                            ")]),r("el-dropdown-item",{attrs:{command:"removeGroup|"+o.id}},[r("i",{staticClass:"el-icon-delete"}),e._v("删除\n                            ")])],1):r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{attrs:{command:"removeDoc|"+o.id}},[r("i",{staticClass:"el-icon-delete"}),e._v("删除\n                            ")])],1)],1)],1)}}])})],1)]),r("el-dropdown",{ref:"rightClick",attrs:{trigger:"click","show-timeout":1,placement:"bottom","hide-timeout":1}},[r("span",{staticClass:"el-dropdown-link",on:{click:function(e){e.stopPropagation()}}}),r("el-dropdown-menu",{attrs:{slot:"dropdown","visible-arrow":!1},slot:"dropdown"},[r("el-dropdown-item",[r("i",{staticClass:"el-icon-edit-outline"}),e._v("编辑文档\n            ")]),r("el-dropdown-item",[r("i",{staticClass:"el-icon-edit"}),e._v("编辑分组\n            ")]),r("el-dropdown-item",[r("i",{staticClass:"el-icon-document-add"}),e._v("新增文档\n            ")]),r("el-dropdown-item",[r("i",{staticClass:"el-icon-folder-add"}),e._v("新增分组\n            ")]),r("el-dropdown-item",[r("i",{staticClass:"el-icon-edit"}),e._v("重命名\n            ")]),r("el-dropdown-item",[r("i",{staticClass:"el-icon-delete"}),e._v("删除\n            ")])],1)],1),r("c-library-content-doc-group-modal",{attrs:{visible:e.groupModal.visible,"library-id":e.libraryId,"parent-id":e.groupModal.parentId,"group-id":e.groupModal.groupId},on:{"update:visible":function(t){return e.$set(e.groupModal,"visible",t)},close:e.onGroupModalClose}})],1)},o=[],i=(r("55dd"),r("28a5"),r("c5f6"),r("96cf"),r("3b8d")),a=(r("ac6a"),r("5710")),c={name:"c-library-content-tree",components:{"c-library-content-doc-group-modal":function(){return r.e("chunk-ef8210b0").then(r.bind(null,"0da2"))}},mixins:[a["a"]],computed:{showGroupTree:function(){return!this.groupTreeLoading},dataTree:function(){var e=this,t={},r=this.$utils.CloneDeep(this.groupTree),n=this.$utils.CloneDeep(this.docList);return n.filter((function(t){return t.title.indexOf(e.searchKey)>=0})).forEach((function(e){e.nodeType="doc",e.name=e.title,e.key="doc-"+e.id,t[e.group_id]||(t[e.group_id]=[]),t[e.group_id].push(e)})),t[0]&&(r=r.concat(t[0])),this.deepBuildDataTree(r,t)},emptyText:function(){return this.groupTreeLoading?"":"暂无数据"}},data:function(){return{searchKey:"",groupTree:[],docList:[],groupTreeLoading:!0,defaultProps:{children:"children",label:"name"},groupModal:{groupId:0,parentId:0,visible:!1}}},methods:{initComponent:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getDocGroupTree();case 2:return e.next=4,this.getDocList();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),initEventBus:function(e){var t=this;e.$on("doc-group-will-create",(function(){t.openGroupModal(0,0)})),e.$on("doc-group-will-modify",(function(e){t.openGroupModal(e)})),e.$on("doc-saved",(function(e){t.initComponent()})),e.$on("library-content-tree-flush",(function(){t.initComponent()})),e.$on("doc-remove",(function(e){var r=e.docId;t.onDocRemove(r)}))},getDocGroupTree:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={library_id:this.libraryId},e.next=3,this.$api.v1.LibraryDocGroupTree(t,{loading:function(e){r.groupTreeLoading=e}}).then((function(e){var t=e.resData;r.groupTree=t}));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getDocList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={library_id:this.libraryId},e.next=3,this.$api.v1.LibraryDocList(t,{loading:function(e){r.groupTreeLoading=e}}).then((function(e){var t=e.resData;r.docList=t}));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),removeDocGroup:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var n,o,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={library_doc_group_id:t,is_deep:r,library_id:this.libraryId},o=!1,e.next=4,this.$api.v1.LibraryDocGroupRemove(n,{report:!0}).then((function(e){e.resMsg;var t=e.resData;i.$tip.success("删除成功"),o=!0,t.forEach((function(e){i.libraryContentEventBus.$emit("doc-removed",{docId:e,groupId:0})}))})).catch((function(e){var t=e.resMsg;i.$tip.error(t)}));case 4:return e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}(),onVisibleChagne:function(e){},onNodeClick:function(e){"doc"===e.nodeType&&this.libraryContentEventBus.$emit("doc-will-modify",e.id)},onNodeContextMenu:function(e){},openGroupModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.groupModal.groupId=Number(e),this.groupModal.parentId=Number(t),this.groupModal.visible=!0},onItemAction:function(e){var t=e.split("|"),r=t[0],n=t[1];switch(r){case"modifyGroup":this.openGroupModal(n);break;case"createGroup":this.openGroupModal(0,n);break;case"removeGroup":this.onRemoveGroup(n);break;case"createDoc":this.libraryContentEventBus.$emit("doc-will-create",n);break;case"removeDoc":this.onDocRemove(n);break;default:break}},onRemoveGroup:function(e){var t=this,r=this.$createElement;this.$msgbox({title:"删除分组",message:r("div",{key:Date.now()},[r("p",null,"此操作将永久删除该分组, 是否继续?"),r("br"),r("el-checkbox",null,"同时删除该分组下所有内容（包含分组、文档）")]),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(){var r=Object(i["a"])(regeneratorRuntime.mark((function r(n,o,i){var a,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(a=o.$el.querySelector(".el-checkbox__original").checked?1:0,"confirm"!==n){r.next=16;break}return o.confirmButtonLoading=!0,o.confirmButtonText="删除中...",r.next=6,t.removeDocGroup(e,a);case 6:return c=r.sent,o.confirmButtonText="确定",c&&i(),o.confirmButtonLoading=!1,r.next=12,t.getDocGroupTree();case 12:return r.next=14,t.getDocList();case 14:r.next=17;break;case 16:i();case 17:case"end":return r.stop()}}),r)})));function n(e,t,n){return r.apply(this,arguments)}return n}()})},onDocRemove:function(e){var t=this;this.$msgbox({title:"删除文档",message:"此操作将永久删除该文档, 是否继续?",showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(){var r=Object(i["a"])(regeneratorRuntime.mark((function r(n,o,i){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if("confirm"!==n){r.next=11;break}return o.confirmButtonLoading=!0,o.confirmButtonText="删除中...",r.next=5,t.docRemove(e);case 5:a=r.sent,o.confirmButtonText="确定",a&&i(),o.confirmButtonLoading=!1,r.next=12;break;case 11:i();case 12:case"end":return r.stop()}}),r)})));function n(e,t,n){return r.apply(this,arguments)}return n}()})},docRemove:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={library_doc_id:t,library_id:this.libraryId},n=!1,e.next=4,this.$api.v1.LibraryDocRemove(r,{loading:function(e){o.libraryManagerLoading=e}}).then((function(e){var r=e.resMsg;o.$tip.success(r),n=!0,o.libraryContentEventBus.$emit("library-content-tree-flush"),o.libraryContentEventBus.$emit("doc-removed",{docId:t})}));case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onGroupModalClose:function(e){e.isUpdated&&this.getDocGroupTree()},onNodeDrop:function(e,t,r,n){var o=this.computedNodePosition(this.dataTree,r,t.data);this.modifyParentGroup(e.data.nodeType,e.data.id,o.pid,o.sort)},deepBuildDataTree:function(e,t){var r=this;return e&&0!==e.length?(e=this.$utils.CloneDeep(e),e.forEach((function(e){e.nodeType=e.nodeType?e.nodeType:"group",e.key="group-"+e.id,e.children=r.deepBuildDataTree(e.children,t)||[],t[e.id]&&(e.children=e.children.concat(t[e.id])),e.children&&e.children.sort((function(e,t){return e.sort-t.sort}))})),e.sort((function(e,t){return e.sort-t.sort})),e):[]},handleAllowDrop:function(e,t,r){var n=t.data.nodeType,o=e.data.nodeType,i=n===o&&"doc"===n&&"inner"===r,a="group"===o&&"doc"===n&&"inner"===r;return!(i||a)},modifyParentGroup:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n){var o,i,a,c=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=s.length>3&&void 0!==s[3]?s[3]:-1,i="group"===t?this.$api.v1.LibraryDocGroupSort:this.$api.v1.LibraryDocSort,a={library_id:this.libraryId,parent_group_id:n,sort:o},a["group"===t?"library_doc_group_id":"library_doc_id"]=r,e.next=6,i(a,{loading:function(e){c.groupTreeLoading=e}});case 6:if("group"!==t){e.next=11;break}return e.next=9,this.getDocGroupTree();case 9:e.next=14;break;case 11:return this.libraryContentEventBus.$emit("doc-modifyed",{docId:r}),e.next=14,this.getDocList();case 14:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}(),computedNodePosition:function(e,t,r){var n=0,o=0;n="inner"===t?r.id:"group"===r.nodeType?r.pid:r.group_id;var i=this.searchNodeTargetGroup(e,n);if(null===i)throw new Error("排序值计算失败");switch(t){case"inner":o=i.children.length>1?i.children.slice(-2,-1)[0].sort+1e4:1e4;break;case"before":i.children.forEach((function(e,t,n){if(e.id===r.id){var i=1===t?0:n[t-2].sort;o=(e.sort+i)/2}}));break;case"after":i.children.forEach((function(e,t,n){if(e.id===r.id){var i=t===n.length-2?e.sort+2e4:n[t+2].sort;o=(e.sort+i)/2}}));break}return{sort:o,pid:n}},searchNodeTargetGroup:function(e,t){var r=this;if(0===t)return{children:e};var n=null;return e.forEach((function(e){"group"===e.nodeType&&e.id===t&&(n=e),!n&&Array.isArray(e.children)&&e.children.length>0&&(n=r.searchNodeTargetGroup(e.children,t))})),n}}},s=c,u=(r("6757"),r("f7e5"),r("2877")),d=Object(u["a"])(s,n,o,!1,null,"59817e77",null);t["default"]=d.exports},"852e":function(e,t,r){},"8b97":function(e,t,r){var n=r("d3f4"),o=r("cb7c"),i=function(e,t){if(o(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,n){try{n=r("9b43")(Function.call,r("11e9").f(Object.prototype,"__proto__").set,2),n(e,[]),t=!(e instanceof Array)}catch(o){t=!0}return function(e,r){return i(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:i}},aa77:function(e,t,r){var n=r("5ca1"),o=r("be13"),i=r("79e5"),a=r("fdef"),c="["+a+"]",s="​",u=RegExp("^"+c+c+"*"),d=RegExp(c+c+"*$"),l=function(e,t,r){var o={},c=i((function(){return!!a[e]()||s[e]()!=s})),u=o[e]=c?t(p):a[e];r&&(o[r]=u),n(n.P+n.F*c,"String",o)},p=l.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(d,"")),e};e.exports=l},c5f6:function(e,t,r){"use strict";var n=r("7726"),o=r("69a8"),i=r("2d95"),a=r("5dbc"),c=r("6a99"),s=r("79e5"),u=r("9093").f,d=r("11e9").f,l=r("86cc").f,p=r("aa77").trim,f="Number",h=n[f],m=h,v=h.prototype,g=i(r("2aeb")(v))==f,b="trim"in String.prototype,y=function(e){var t=c(e,!1);if("string"==typeof t&&t.length>2){t=b?t.trim():p(t,3);var r,n,o,i=t.charCodeAt(0);if(43===i||45===i){if(r=t.charCodeAt(2),88===r||120===r)return NaN}else if(48===i){switch(t.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+t}for(var a,s=t.slice(2),u=0,d=s.length;u<d;u++)if(a=s.charCodeAt(u),a<48||a>o)return NaN;return parseInt(s,n)}}return+t};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof h&&(g?s((function(){v.valueOf.call(r)})):i(r)!=f)?a(new m(y(t)),r,h):y(t)};for(var w,x=r("9e1e")?u(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;x.length>_;_++)o(m,w=x[_])&&!o(h,w)&&l(h,w,d(m,w));h.prototype=v,v.constructor=h,r("2aba")(n,f,h)}},f7e5:function(e,t,r){"use strict";var n=r("852e"),o=r.n(n);o.a},fdef:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);